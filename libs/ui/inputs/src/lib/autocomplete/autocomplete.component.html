<ng-template #searchButton>
  <div class="absolute inset-y-0" [ngClass]="{ 'right-0': !searchFirst }">
    <button
      type="button"
      class="gn-ui-autocomplete-search search-btn"
      aria-label="Trigger search"
      *ngIf="allowSubmit"
      data-test="autocomplete-submit-btn"
      (click)="handleClickSearch()"
    >
      <mat-icon class="material-symbols-outlined">search</mat-icon>
    </button>
  </div>
</ng-template>

<div class="gn-ui-autocomplete">
  <ng-container *ngIf="searchFirst">
    <ng-template [ngTemplateOutlet]="searchButton"></ng-template>
  </ng-container>
  <div class="relative" [ngClass]="searchFirst ? 'left-14' : 'left-0'">
    <input
      #searchInput
      type="text"
      class="gn-ui-autocomplete-input"
      [placeholder]="placeholder"
      [formControl]="control"
      [matAutocomplete]="auto"
      (keyup.enter)="handleEnter(searchInput.value)"
    />
    <button
      type="button"
      [ngClass]="allowSubmit ? 'right-14' : 'right-0'"
      class="gn-ui-autocomplete-clear clear-btn"
      *ngIf="searchInput.value"
      aria-label="Clear"
      (click)="clear()"
    >
      <mat-icon class="material-symbols-outlined">close</mat-icon>
    </button>
    <ng-container *ngIf="!searchFirst">
      <ng-template [ngTemplateOutlet]="searchButton"></ng-template>
    </ng-container>
  </div>
  <gn-ui-popup-alert
    *ngIf="error"
    class="absolute mt-2 w-full top-[100%] left-0"
    icon="error_outline"
    position="top"
    type="warning"
  >
    <span translate>search.autocomplete.error</span>
    {{ error }}
  </gn-ui-popup-alert>
</div>
<mat-autocomplete
  #auto="matAutocomplete"
  (optionSelected)="handleSelection($event)"
  [displayWith]="displayWithFnInternal"
>
  <mat-option
    *ngFor="let suggestion of suggestions$ | async"
    [value]="suggestion"
    class="p-2 suggestion"
  >
    {{ displayWithFnInternal(suggestion) }}
  </mat-option>
</mat-autocomplete>
